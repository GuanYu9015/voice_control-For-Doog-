# è­·ç†è»ŠèªéŸ³æ§åˆ¶ç³»çµ± / Nursing Cart Voice Control System

> åŸºæ–¼ Jetson Orin NX çš„é†«é™¢è­·ç†è»Šæ™ºèƒ½èªéŸ³æ§åˆ¶ç³»çµ±  
> æ”¯æ´å–šé†’è©ã€ä¸­æ–‡èªéŸ³è¾¨è­˜ã€LLM æ™ºèƒ½å°èˆªèˆ‡ MQTT å°èˆªæ§åˆ¶

---

## ğŸ“‹ å°ˆæ¡ˆç°¡ä»‹

æœ¬ç³»çµ±ç‚ºé†«é™¢è­·ç†è¼”åŠ©è»Šï¼ˆThouzer è¼‰å…·ï¼‰è¨­è¨ˆçš„èªéŸ³æ§åˆ¶ä»‹é¢ï¼Œæ•´åˆèªéŸ³è¾¨è­˜ã€å¤§å‹èªè¨€æ¨¡å‹ï¼ˆLLMï¼‰èˆ‡ MQTT å°èˆªæ§åˆ¶ï¼Œå¯¦ç¾è‡ªç„¶èªè¨€äº’å‹•çš„ç—…æˆ¿å°èˆªåŠŸèƒ½ã€‚

### æ ¸å¿ƒåŠŸèƒ½

- **èªéŸ³å–šé†’**ï¼šæ”¯æ´ã€Œæ™ºè­·è»Šã€ã€ã€Œè­·ç†è»Šã€ç­‰è‡ªå®šç¾©å–šé†’è©
- **è‡ªç„¶èªè¨€å°èˆª**ï¼šã€Œåˆ°äº”è™Ÿç—…æˆ¿ã€ã€ã€Œå›è­·ç†ç«™ã€ç­‰å£èªåŒ–æŒ‡ä»¤
- **è·Ÿéš¨æ¨¡å¼**ï¼šã€Œé–‹å§‹è·Ÿéš¨ã€ã€ã€Œåœæ­¢è·Ÿéš¨ã€
- **æ™ºèƒ½è·¯å¾‘è¦åŠƒ**ï¼šè‡ªå‹•è¨ˆç®—èµ·çµ‚é»è·¯å¾‘ï¼Œæ”¯æ´ 17 å€‹ç—…æˆ¿ + è­·ç†ç«™å°èˆª
- **åœ–å½¢åŒ–ä»‹é¢**ï¼šTkinter UIï¼Œé¡¯ç¤ºæ¨“å±¤åœ°åœ–ã€ç«™é»é¸æ“‡ã€èªéŸ³å°è©±

### æŠ€è¡“æ¶æ§‹

```
å–šé†’è©åµæ¸¬ (KWS) â†’ èªéŸ³è¾¨è­˜ (ASR) â†’ å¤§å‹èªè¨€æ¨¡å‹ (LLM) â†’ æŒ‡ä»¤è§£æ â†’ MQTT æ§åˆ¶ Thouzer è¼‰å…·
        â†“
    DeepFilterNet é™å™ª + Silero VAD èªéŸ³æ´»å‹•åµæ¸¬
```

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### æŠ€è¡“æ£§

| æ¨¡çµ„ | æŠ€è¡“æ–¹æ¡ˆ | èªªæ˜ |
|------|----------|------|
| **DNS** | DeepFilterNet3 | æ·±åº¦å­¸ç¿’å™ªéŸ³æŠ‘åˆ¶ï¼ˆå³æ™‚ä¸²æµï¼‰ |
| **VAD** | Silero VAD (Sherpa-ONNX) | èªéŸ³æ´»å‹•åµæ¸¬ |
| **KWS** | Sherpa-ONNX Zipformer (zh-en) | ä¸­è‹±é›™èªå–šé†’è©åµæ¸¬ |
| **ASR** | Sherpa-ONNX Streaming Zipformer | ä¸­æ–‡èªéŸ³è¾¨è­˜ï¼ˆä¸²æµï¼‰ |
| **TTS** | Sherpa-ONNX VITS (AISHELL-3) | ä¸­æ–‡èªéŸ³åˆæˆ |
| **LLM** | llama.cpp (Qwen 2.5-7B) | æ„åœ–ç†è§£èˆ‡æŒ‡ä»¤ç”Ÿæˆ |
| **å°èˆª** | MQTT + Thouzer | è¼‰å…·è»Œè·¡åŸ·è¡Œ |

### å°ˆæ¡ˆçµæ§‹

```
voice_control/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ model_config.yaml      # æ¨¡å‹è·¯å¾‘è¨­å®šï¼ˆKWS/ASR/TTS/LLMï¼‰
â”‚   â”œâ”€â”€ audio_config.yaml      # éŸ³è¨Šè¨­å®šï¼ˆå–æ¨£ç‡ã€chunk_msï¼‰
â”‚   â””â”€â”€ robot_config.yaml      # è¼‰å…·/ç«™é»/MQTT è¨­å®š
â”œâ”€â”€ models/                     # AI æ¨¡å‹æª”æ¡ˆ
â”‚   â”œâ”€â”€ dns/                    # DeepFilterNet
â”‚   â”œâ”€â”€ vad/                    # Silero VAD
â”‚   â”œâ”€â”€ kws/                    # KWS æ¨¡å‹ + keywords.txt
â”‚   â”œâ”€â”€ asr/                    # Streaming Zipformer (ä¸­æ–‡)
â”‚   â”œâ”€â”€ tts/                    # VITS åˆæˆå™¨
â”‚   â””â”€â”€ llm/                    # LLM æ¨¡å‹ (GGUF)
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ async_pipeline.py       # ç•°æ­¥èªéŸ³æ§åˆ¶ Pipelineï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”œâ”€â”€ main_nursing_cart.py    # è­·ç†è»Šæ‡‰ç”¨ç¨‹å¼å…¥å£
â”‚   â”œâ”€â”€ audio/                  # éŸ³è¨Šè¼¸å…¥/è¼¸å‡º/é™å™ª
â”‚   â”œâ”€â”€ speech/                 # VAD/KWS/ASR/TTS æ¨¡çµ„
â”‚   â”œâ”€â”€ llm/                    # LLM æ¨ç†ä»‹é¢
â”‚   â”œâ”€â”€ robot/                  # è¼‰å…·æ§åˆ¶èˆ‡ç«™é»æ˜ å°„
â”‚   â”œâ”€â”€ ui/                     # Tkinter åœ–å½¢ä»‹é¢
â”‚   â””â”€â”€ utils/                  # å·¥å…·å‡½æ•¸
â”œâ”€â”€ scripts/                    # å®‰è£/ä¸‹è¼‰è…³æœ¬
â”œâ”€â”€ logs/                       # æ—¥èªŒè¼¸å‡º
â””â”€â”€ start_nursing_cart.sh       # å•Ÿå‹•è…³æœ¬ï¼ˆå«æ—¥èªŒè¨˜éŒ„ï¼‰
```

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### ç’°å¢ƒéœ€æ±‚

- **ç¡¬é«”**ï¼šNVIDIA Jetson Orin NX (8GB+)
- **ä½œæ¥­ç³»çµ±**ï¼šJetPack 5.1.2 (Ubuntu 20.04)
- **Python**ï¼š3.10+
- **CUDA**ï¼š11.4+ (JetPack è‡ªå¸¶)

### å®‰è£æ­¥é©Ÿ

#### 1. å®‰è£ PyTorchï¼ˆJetson ARM64ï¼‰

```bash
# JetPack 6.x (CUDA 12.6)
pip3 install torch torchvision torchaudio \
  --index-url https://developer.download.nvidia.com/compute/redist/jp/v61/pytorch/

# JetPack 5.x (CUDA 11.4)
pip3 install torch torchvision torchaudio \
  --extra-index-url https://developer.download.nvidia.com/compute/redist/jp/v512/pytorch/
```

#### 2. å®‰è£ llama.cppï¼ˆCUDA æ”¯æ´ï¼‰

```bash
CMAKE_ARGS="-DLLAMA_CUDA=on" pip install llama-cpp-python
```

#### 3. å®‰è£å…¶ä»–ä¾è³´

```bash
cd /home/jetson/voice_control
pip install -r requirements.txt

# é¡å¤–ä¾è³´ï¼ˆç°¡ç¹è½‰æ› + æ‹¼éŸ³æ ¡æ­£ï¼‰
pip install opencc-python-reimplemented pypinyin
```

#### 4. ä¸‹è¼‰ AI æ¨¡å‹

```bash
# ä¸‹è¼‰æ‰€æœ‰å¿…è¦æ¨¡å‹ï¼ˆVAD/ASR/TTS/KWSï¼‰
bash scripts/download_models.sh

# ä¸‹è¼‰ LLM æ¨¡å‹ï¼ˆQwen 2.5-7Bï¼Œç´„ 4.7GBï¼‰
python scripts/download_llm_models.py
```

#### 5. è¨­å®šå–šé†’è©

ç·¨è¼¯ `models/kws/keywords.txt`ï¼ˆæ‹¼éŸ³æ ¼å¼ï¼‰ï¼š

```
h Ã¹ l Ç ch Ä“ @æŠ¤ç†è½¦
zh Ã¬ h Ã¹ ch Ä“ @æ™ºæŠ¤è½¦
```

---

## ğŸ“¦ å¯ç”¨æ¨¡å‹æ¸…å–®

æœ¬ç³»çµ±æ•´åˆå¤šç¨®èªéŸ³èˆ‡èªè¨€æ¨¡å‹ï¼Œä»¥ä¸‹ç‚ºå„æ¨¡çµ„æ”¯æ´åŠå·²æ•´åˆçš„æ¨¡å‹åˆ—è¡¨ï¼š

### 1. èªéŸ³å¢å¼· (DNS)

| æ¨¡å‹/æ–¹æ¡ˆ | é¡å‹ | èªªæ˜ | ç‹€æ…‹ |
|-----------|------|------|------|
| **DeepFilterNet3** | PyTorch | **(æ¨è–¦)** é™å™ªæ•ˆæœæœ€ä½³ï¼Œæ”¯æ´å³æ™‚ä¸²æµ | âœ… é è¨­å•Ÿç”¨ |
| **NSNet2** | ONNX | è¼•é‡ç´šå‚™ç”¨æ–¹æ¡ˆ (éœ€æ‰‹å‹•ä¸‹è¼‰) | æ”¯æ´ |
| **Passthrough** | - | ç„¡è™•ç† (é™¤éŒ¯ç”¨) | æ”¯æ´ |

### 2. èªéŸ³æ´»å‹•åµæ¸¬ (VAD)

| æ¨¡å‹ | ä¾†æº | èªªæ˜ |
|------|------|------|
| **Silero VAD** | Sherpa-ONNX | é«˜æ•ˆèƒ½èªéŸ³æ´»å‹•åµæ¸¬ï¼Œç”¨æ–¼åˆ¤æ–·èªªè©±èµ·æ­¢ |

### 3. å–šé†’è©åµæ¸¬ (KWS)

| æ¨¡å‹ | ç‰ˆæœ¬ | ç‰¹æ€§ | è³‡æ–™å¤¾ |
|------|------|------|--------|
| **Zipformer (zh-en)** | 2025-12-20 | **(æ¨è–¦)** ä¸­è‹±é›™èªï¼Œé«˜æº–ç¢ºåº¦ | `sherpa-onnx-kws-zipformer-zh-en-3M-2025-12-20` |
| **Zipformer (WenetSpeech)** | 2024-01-01 | èˆŠç‰ˆæ¨¡å‹ | `sherpa-onnx-kws-zipformer-wenetspeech-3.3M-2024-01-01` |

### 4. èªéŸ³è¾¨è­˜ (ASR)

æ”¯æ´å¤šç¨® Sherpa-ONNX Streaming Zipformer é‡åŒ–ç‰ˆæœ¬ï¼Œå¯æ ¹æ“šç¡¬é«”é¸æ“‡ï¼š

| ç‰ˆæœ¬ | æª”åç‰¹å¾µ | é©ç”¨å ´æ™¯ | èªªæ˜ |
|------|----------|----------|------|
| **FP16** | `fp16` | **Jetson Orin (GPU)** | **(æ¨è–¦)** å¹³è¡¡é€Ÿåº¦èˆ‡ç²¾åº¦ï¼ŒGPU åŠ é€Ÿæœ€ä½³åŒ– |
| **INT8** | `int8` | ç´” CPU / é‚Šç·£è£ç½® | é€Ÿåº¦æœ€å¿«ï¼Œè¨˜æ†¶é«”ä½”ç”¨æœ€å°ï¼Œç²¾åº¦ç•¥é™ |
| **FP32** | (ç„¡å¾Œç¶´) | é«˜ç²¾åº¦éœ€æ±‚ | åŸå§‹æ¨¡å‹ï¼Œç²¾åº¦æœ€é«˜ä½†é‹ç®—éœ€æ±‚å¤§ |
| **Old (14M)** | `14M` | æ¥µä½è³‡æºè£ç½® | èˆŠç‰ˆè¼•é‡æ¨¡å‹ |
| **Paraformer** | `paraformer` | é›¢ç·šæ‰¹æ¬¡è™•ç† | éä¸²æµæ¨¡å‹ï¼Œç²¾åº¦æœ€é«˜ |

### 5. èªéŸ³åˆæˆ (TTS)

| æ¨¡å‹ | ä¾†æº | èªªæ˜ |
|------|------|------|
| **VITS** | AISHELL-3 | ä¸­æ–‡å¤šèªè€…èªéŸ³åˆæˆï¼Œè‡ªç„¶åº¦é«˜ |

### 6. å¤§å‹èªè¨€æ¨¡å‹ (LLM)

æ”¯æ´ `llama.cpp` (GGUF æ ¼å¼)ï¼Œä»¥ä¸‹ç‚ºç¶“æ¸¬è©¦ç›¸å®¹çš„æ¨¡å‹ï¼š

| æ¨¡å‹åç¨± | åƒæ•¸è¦æ¨¡ | æ¨è–¦ç”¨é€” | æª”æ¡ˆç¯„ä¾‹ |
|----------|----------|----------|----------|
| **Qwen 2.5** | 7B | **(æ¨è–¦)** æŒ‡ä»¤éµå¾ªèƒ½åŠ›å¼·ï¼Œä¸­æ–‡ç†è§£ä½³ | `Qwen2.5-7B-Instruct-Q4_K_M.gguf` |
| **Qwen 2.5** | 3B | å¿«é€Ÿå›æ‡‰ï¼Œä½å»¶é² | `qwen2.5-3b-instruct-q4_k_m.gguf` |
| **Llama 3.2** | 3B | å¤šèªè¨€æ³›ç”¨ | `llama-3.2-3b-instruct-q4_k_m.gguf` |
| **Llama 3.2 TW** | 3B | é‡å°å°ç£ç”¨èªå¾®èª¿ | `Llama-3.2-Taiwan-3B-Instruct.Q4_K_M.gguf` |
| **TAIDE** | 8B | å°ç£ç¹é«”ä¸­æ–‡å„ªåŒ– | `Llama3-TAIDE-LX-8B-Chat-Alpha1.Q4_K_M.gguf` |

---

## ğŸ® ä½¿ç”¨æ–¹å¼

### å•Ÿå‹•ç³»çµ±

```bash
# å•Ÿå‹•è­·ç†è»ŠèªéŸ³æ§åˆ¶ï¼ˆå« UIï¼‰
./start_nursing_cart.sh

# ä½¿ç”¨ Mock Robotï¼ˆç„¡éœ€ MQTTï¼Œç”¨æ–¼æ¸¬è©¦ï¼‰
./start_nursing_cart.sh --mock-robot

# ç´”å‘½ä»¤åˆ—æ¨¡å¼ï¼ˆç„¡ UIï¼‰
./start_nursing_cart.sh --no-ui
```

### èªéŸ³æŒ‡ä»¤ç¯„ä¾‹

| ä½¿ç”¨æƒ…å¢ƒ | èªéŸ³æŒ‡ä»¤ | ç³»çµ±è¡Œç‚º |
|----------|----------|----------|
| å–šé†’ç³»çµ± | ã€Œè­·ç†è»Šã€ | TTS å›æ‡‰ï¼šã€Œæˆ‘åœ¨ï¼Œè«‹èªªã€ |
| å°èˆªç—…æˆ¿ | ã€Œåˆ°äº”è™Ÿç—…æˆ¿ã€ | åŸ·è¡Œè·¯å¾‘ Oâ†’E (è­·ç†ç«™â†’5è™Ÿç—…æˆ¿) |
| é€£çºŒå°èˆª | ã€Œå¾ä¸ƒè™Ÿåˆ°åè™Ÿç—…æˆ¿ã€ | åŸ·è¡Œè·¯å¾‘ Gâ†’J |
| ä¸€æ°£å‘µæˆ | ã€Œè­·ç†è»Šåˆ°åä¸ƒè™Ÿç—…æˆ¿ã€ | å–šé†’+å°èˆª (Oâ†’R) |
| è¿”å›è­·ç†ç«™ | ã€Œå›è­·ç†ç«™ã€ | åŸ·è¡Œè·¯å¾‘ Xâ†’O |
| è·Ÿéš¨æ¨¡å¼ | ã€Œé–‹å§‹è·Ÿéš¨ã€ | å•Ÿå‹•è·Ÿéš¨æ¨¡å¼ |
| åœæ­¢è·Ÿéš¨ | ã€Œåœæ­¢è·Ÿéš¨ã€ | åœæ­¢è·Ÿéš¨ |

### UI æ“ä½œ

- **åœ°åœ–é¢æ¿**ï¼šé»é¸èµ·é»â†’çµ‚é»ï¼ŒåŸ·è¡Œå»ºåœ–è»Œè·¡
- **ç‹€æ…‹åˆ—**ï¼šé¡¯ç¤ºå–šé†’ç‹€æ…‹ã€èªéŸ³é€£æ¥ã€MQTT é€£ç·šã€ç•¶å‰ä½ç½®
- **èªéŸ³å°è©±**ï¼šå³æ™‚é¡¯ç¤º LLM å›æ‡‰èˆ‡æŒ‡ä»¤åŸ·è¡Œçµæœ

---

## âš™ï¸ ç³»çµ±é…ç½®

### KWS å–šé†’è©é…ç½®

ç·¨è¼¯ `config/model_config.yaml`ï¼š

```yaml
kws:
  model_path: kws/sherpa-onnx-kws-zipformer-zh-en-3M-2025-12-20
  keywords_file: kws/keywords.txt
  threshold: 0.05      # éˆæ•åº¦ï¼ˆ0.0-1.0ï¼Œè¶Šå°è¶Šéˆæ•ï¼‰
  keywords_score: 2.0  # é—œéµè©æ¬Šé‡
```

### ASR èª¤è¾¨è­˜æ ¡æ­£

ç³»çµ±å…§å»ºæ‹¼éŸ³æ ¡æ­£å™¨ï¼ˆ`src/utils/pinyin_corrector.py`ï¼‰ï¼Œè‡ªå‹•ä¿®æ­£å¸¸è¦‹èª¤è¾¨è­˜ï¼š

| èª¤è¾¨è­˜ | ä¿®æ­£ç‚º | é¡å‹ |
|--------|--------|------|
| æƒ¡è™Ÿã€å™©è€—ã€é¤“è™Ÿ | äºŒè™Ÿ | æ•¸å­—åŒéŸ³ |
| æ™‚å€™ç—…æˆ¿ | åè™Ÿç—…æˆ¿ | é€£è®€èª¤è­˜ |
| æ™‚å°šè™Ÿ | åä¸‰è™Ÿ | é€£è®€èª¤è­˜ |
| ç‚ºè­·ç†æˆ° | å›è­·ç†ç«™ | åŒéŸ³è© |
| è‡ªé¡§è»Šã€çŸ¥è­·è»Š | æ™ºè­·è»Š | å–šé†’è©è®Šé«” |

å¦‚éœ€æ·»åŠ æ–°çš„æ ¡æ­£è¦å‰‡ï¼Œç·¨è¼¯ `pinyin_corrector.py` ä¸­çš„ `_direct_mappings` å­—å…¸ã€‚

### ç«™é»å°ç…§è¡¨

æœ¬ç³»çµ±é è¨­é…ç½® 17 å€‹ç—…æˆ¿ + 1 å€‹è­·ç†ç«™ï¼ˆä¾†æºï¼š`config/robot_config.yaml`ï¼‰

| ä»£è™Ÿ | ç—…æˆ¿è™Ÿç¢¼ | åç¨± | ä»£è™Ÿ | ç—…æˆ¿è™Ÿç¢¼ | åç¨± |
|------|----------|------|------|----------|------|
| O | - | è­·ç†ç«™ | J | 3210 | 10è™Ÿç—…æˆ¿ |
| A | 3201 | 1è™Ÿç—…æˆ¿ | K | 3211 | 11è™Ÿç—…æˆ¿ |
| B | 3202 | 2è™Ÿç—…æˆ¿ | L | 3212 | 12è™Ÿç—…æˆ¿ |
| C | 3203 | 3è™Ÿç—…æˆ¿ | M | 3213 | 13è™Ÿç—…æˆ¿ |
| D | 3204 | 4è™Ÿç—…æˆ¿ | N | 3214 | 14è™Ÿç—…æˆ¿ |
| E | 3205 | 5è™Ÿç—…æˆ¿ | P | 3215 | 15è™Ÿç—…æˆ¿ |
| F | 3206 | 6è™Ÿç—…æˆ¿ | Q | 3216 | 16è™Ÿç—…æˆ¿ |
| G | 3207 | 7è™Ÿç—…æˆ¿ | R | 3217 | 17è™Ÿç—…æˆ¿ |
| H | 3208 | 8è™Ÿç—…æˆ¿ | - | - | - |
| I | 3209 | 9è™Ÿç—…æˆ¿ | - | - | - |

> æ³¨æ„ï¼šè‹±æ–‡ä»£è™Ÿè·³é Oï¼ˆè­·ç†ç«™å°ˆç”¨ï¼‰ï¼Œæ‰€ä»¥ 15è™Ÿ=P, 16è™Ÿ=Q, 17è™Ÿ=R

### LLM Prompt Engineering

æœ¬ç³»çµ±ä½¿ç”¨ **Chain of Thought (CoT)** æŠ€è¡“æå‡ LLM æº–ç¢ºåº¦ï¼š

1. **å‚ç›´æ˜ å°„è¡¨**ï¼š`1è™Ÿ -> A` æ ¼å¼ï¼ˆè€Œé `A=1è™Ÿ`ï¼‰ï¼Œé™ä½ LLM ä½ç§»éŒ¯èª¤
2. **Reasoning æ¬„ä½**ï¼šå¼·åˆ¶ LLM å…ˆè¼¸å‡ºæ¨ç†é‚è¼¯ï¼ˆ`"reasoning":"Rule: 5è™Ÿ=E. Target is E."`ï¼‰
3. **è² å‘ç´„æŸ**ï¼šæ˜ç¢ºç¦æ­¢æŒ‰å­—æ¯é †åºçŒœæ¸¬ï¼ˆ`DO NOT calculate letter positions`ï¼‰
4. **Route è‡ªå‹•ä¿®æ­£**ï¼šç¨‹å¼æ ¹æ“š `current_position + target` è‡ªå‹•è¨ˆç®—æ­£ç¢º route

å®Œæ•´ Prompt å®šç¾©ï¼š[`src/robot/nursing_commands.py`](src/robot/nursing_commands.py#L121)

### ASR èª¤è¾¨è­˜ä¿®æ­£

å¸¸è¦‹å£èªèª¤è¾¨è­˜è‡ªå‹•ä¿®æ­£ï¼ˆ`src/async_pipeline.py`ï¼‰ï¼š

| èª¤è¾¨è­˜ | ä¿®æ­£ç‚º |
|--------|--------|
| è·Ÿæ°´ã€æ ¹æ°´ã€è·Ÿèª°ã€æ ¹éš¨ | è·Ÿéš¨ |

---

## ğŸ”§ é€²éšé…ç½®

### èª¿æ•´ LLM æ¨¡å‹

ç·¨è¼¯ `config/model_config.yaml`ï¼š

```yaml
llm:
  llama_cpp:
    model_path: models/llm/Qwen2.5-7B-Instruct-Q4_K_M.gguf  # æ›¿æ›æ¨¡å‹
    n_ctx: 8192        # Context Windowï¼ˆé¿å… token æº¢å‡ºï¼‰
    n_gpu_layers: -1   # GPU å±¤æ•¸ï¼ˆ-1 = å…¨éƒ¨ï¼‰
```

æ¨è–¦æ¨¡å‹ï¼š
- **Qwen 2.5-3B**ï¼šé€Ÿåº¦å¿«ï¼Œé©åˆå³æ™‚å›æ‡‰ï¼ˆ2GBï¼‰
- **Qwen 2.5-7B**ï¼šæº–ç¢ºåº¦é«˜ï¼Œæ¨è–¦ä½¿ç”¨ï¼ˆ4.7GBï¼‰

### èª¿æ•´ TTS èªé€Ÿ

åœ¨ `src/async_pipeline.py` ç¬¬ 200 è¡Œï¼š

```python
self.tts = create_tts(model_dir=str(tts_dirs[0]), speed=0.8)  # 0.5-2.0
```

### å–šé†’è©è®Šé«”

åœ¨ `src/speech/kws.py` æ–°å¢è«§éŸ³è®Šé«”ä»¥æé«˜åŒ¹é…ç‡ï¼š

```python
# é è¨­å–šé†’è©
DEFAULT_KEYWORDS = ["æ™ºè­·è»Š", "è­·ç†è»Š"]

SIMPLIFIED_VARIANTS = {
    "æ™ºè­·è»Š": ["æ™ºæŠ¤è½¦", "è‡ªè­·è»Š", "ä¹‹è­·è»Š", "å¿—è­·è»Š", ...],
    "è­·ç†è»Š": ["æŠ¤ç†è½¦", "æˆ¶ç†è»Š", "èƒ¡ç†è½¦", ...],
}
```

---

## ğŸ“Š æ•ˆèƒ½æŒ‡æ¨™

| æŒ‡æ¨™ | æ•¸å€¼ |
|------|------|
| å–šé†’è©åµæ¸¬å»¶é² | ~200ms |
| ASR è¾¨è­˜å»¶é² | ~500ms (ä¸²æµ) |
| LLM æ¨ç†å»¶é² | ~1.5s (Qwen 2.5-7B) |
| TTS åˆæˆå»¶é² | ~300ms |
| ç«¯åˆ°ç«¯å»¶é² | ~2.5s (å–šé†’â†’åŸ·è¡Œ) |
| GPU è¨˜æ†¶é«”ä½¿ç”¨ | ~5.5GB |

æ¸¬è©¦ç’°å¢ƒï¼šJetson Orin NX (8GB), JetPack 5.1.2

---

## ğŸ› ç–‘é›£æ’è§£

### 1. DeepFilterNet åˆå§‹åŒ–å¤±æ•—

```bash
# æª¢æŸ¥ torchaudio ç‰ˆæœ¬
python3 -c "import torchaudio; print(torchaudio.__version__)"

# è‹¥é‡åˆ° CUDA kernel éŒ¯èª¤ï¼Œä½¿ç”¨ Passthrough
# ç·¨è¼¯ config/model_config.yaml
dns:
  backend: passthrough
```

### 2. KWS å–šé†’è©ç„¡åæ‡‰

- æª¢æŸ¥ `models/kws/keywords.txt` æ ¼å¼æ˜¯å¦æ­£ç¢ºï¼ˆæ‹¼éŸ³ + ç©ºæ ¼ + @æ¼¢å­—ï¼‰
- èª¿ä½ `threshold` å€¼ï¼ˆå¦‚ 0.05ï¼‰
- ç¢ºèªéº¥å…‹é¢¨éŸ³é‡æ­£å¸¸

### 3. OpenCC æœªå•Ÿç”¨

```bash
# å®‰è£ OpenCC
pip install opencc-python-reimplemented

# é©—è­‰
python3 -c "from opencc import OpenCC; print(OpenCC('s2tw').convert('æŠ¤ç†è½¦'))"
```

### 4. MQTT é€£ç·šå¤±æ•—

```bash
# æ¸¬è©¦ MQTT broker é€£ç·š
mosquitto_sub -h 192.168.212.1 -p 1883 -u mqtt -P <password> -t '#'

# ä½¿ç”¨ mock-robot æ¨¡å¼æ¸¬è©¦
./start_nursing_cart.sh --mock-robot
```

---

## ğŸ“ æˆæ¬Šèˆ‡è²¢ç»

æœ¬å°ˆæ¡ˆç‚ºå…§éƒ¨ç ”ç©¶å°ˆæ¡ˆï¼Œå¦‚éœ€å¼•ç”¨æˆ–ä¿®æ”¹è«‹è¯ç¹«å°ˆæ¡ˆç¶­è­·è€…ã€‚

### æ ¸å¿ƒæŠ€è¡“

- **Sherpa-ONNX**ï¼šèªéŸ³è™•ç†æ¡†æ¶ï¼ˆKWS/VAD/ASR/TTSï¼‰
- **llama.cpp**ï¼šLLM æ¨ç†å¼•æ“
- **DeepFilterNet**ï¼šæ·±åº¦å­¸ç¿’é™å™ª
- **Qwen Team**ï¼šLLM æ¨¡å‹

---

æœ€å¾Œæ›´æ–°ï¼š2025-12-30

